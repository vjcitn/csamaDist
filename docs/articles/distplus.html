<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>distances, nearest-neighbor graphs, clustering • csamaDist</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="distances, nearest-neighbor graphs, clustering">
<meta property="og:description" content="csamaDist">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">csamaDist</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/distplus.html">distances, nearest-neighbor graphs, clustering</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vjcitn/csamaDist/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>distances, nearest-neighbor graphs, clustering</h1>
                        <h4 data-toc-skip class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 data-toc-skip class="date">June 21, 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vjcitn/csamaDist/blob/HEAD/vignettes/distplus.Rmd"><code>vignettes/distplus.Rmd</code></a></small>
      <div class="hidden name"><code>distplus.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="road-map">Road map<a class="anchor" aria-label="anchor" href="#road-map"></a>
</h2>
<ul>
<li>Exploring a cluster analysis of copy-number aberration measures in 28 tumors from one patient
<ul>
<li>interactive heatmap</li>
<li>comparing Euclidean and correlation (1-cor) distances</li>
<li>comparing agglomeration methods</li>
<li>the silhouette as a measure of clustering adequacy</li>
<li>the bluster tools for cluster diagnostics</li>
</ul>
</li>
<li>bluster applied to scRNA-seq
<ul>
<li>Grun pancreas data</li>
<li>NNGraphParam</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="application-inferring-steps-in-tumor-metastasis-in-a-breast-cancer-patient">Application: inferring steps in tumor metastasis in a breast cancer patient<a class="anchor" aria-label="anchor" href="#application-inferring-steps-in-tumor-metastasis-in-a-breast-cancer-patient"></a>
</h2>
<p>We’ll examine data distributed with a <a href="https://genomemedicine.biomedcentral.com/articles/10.1186/s13073-021-00989-6" class="external-link">2021 Genome Biology paper</a> from the Gabor Marth lab.</p>
<div class="figure">
<img src="marthPatient.jpg" alt="Clinical sequence of interventions."><p class="caption">Clinical sequence of interventions.</p>
</div>
<div class="figure">
<img src="marthEvolve.jpg" alt="Event sequence."><p class="caption">Event sequence.</p>
</div>
<div class="section level3">
<h3 id="a-view-of-copy-number-aberrations-for-1mb-tiling">A view of copy number aberrations for 1Mb tiling<a class="anchor" aria-label="anchor" href="#a-view-of-copy-number-aberrations-for-1mb-tiling"></a>
</h3>
<p>28 tumors were sampled and sequenced in a rapid autopsy procedure. Copy number variation was assessed using <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5027494/" class="external-link">FACETS</a>.</p>
<p>The tissues from which tumors were taken are Br (Breast), Bo (Bone), Bn (Brain), Ln (Lung), Lv (Liver), Pa (Pancreas), Ly (Lymph nodes), Kd (Kidney)</p>
<p><a href="cnv-heatmap.html">A plotly-based visualization</a></p>
<p>The (vertical) ordering of tissues is chosen to exemplify certain similarities.</p>
<p>For example the block of blue on chr10 is seen for only three samples. This is an indication of a deletion.</p>
</div>
<div class="section level3">
<h3 id="a-cluster-analysis-proposed-in-support-of-the-evolutionary-map">A cluster analysis proposed in support of the evolutionary map<a class="anchor" aria-label="anchor" href="#a-cluster-analysis-proposed-in-support-of-the-evolutionary-map"></a>
</h3>
<p>This code is lightly modified from a script distributed at <a href="https://github.com/xiaomengh/tumor-evo-rapid-autopsy.git" class="external-link uri">https://github.com/xiaomengh/tumor-evo-rapid-autopsy.git</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vjcitn/csamaDist">csamaDist</a></span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bioDist</span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bluster</span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/cluster/" class="external-link">cluster</a></span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scRNAseq</span><span class="op">)</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scuttle</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">)</span>
<span class="va">data</span> <span class="op">=</span> <span class="va">cnv_log_R</span>
<span class="va">samples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Ln7'</span>,<span class="st">'Ln9'</span>,<span class="st">'Ln1'</span>,<span class="st">'BrM'</span>,<span class="st">'BrP'</span>,
           <span class="st">'Ln11'</span>,<span class="st">'Ly2'</span>,<span class="st">'Ln3'</span>,
           <span class="st">'Bo3'</span>,<span class="st">'Ln10'</span>,<span class="st">'Bo1'</span>,<span class="st">'Ln8'</span>,<span class="st">'Lv3'</span>,<span class="st">'Ln5'</span>,<span class="st">'Bo2'</span>,<span class="st">'Bn2'</span>,<span class="st">'Bn1'</span>,<span class="st">'Bn3'</span>,<span class="st">'Bn4'</span>,<span class="st">'Ln2'</span>,
           <span class="st">'Ly1'</span>,<span class="st">'Ln6'</span>,
           <span class="st">'Kd1'</span>,<span class="st">'Ln4'</span>,<span class="st">'Lv4'</span>,<span class="st">'Lv2'</span>,<span class="st">'Lv1'</span>,<span class="st">'Pa1'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">=</span> <span class="va">samples</span>
<span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">data</span>, method<span class="op">=</span><span class="st">"euclidean"</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">d</span>, method<span class="op">=</span><span class="st">"average"</span><span class="op">)</span>
<span class="co"># the following line changes the order of the samples to produce the Fig.S3B but doesn't change the phylogenetic relationship</span>
<span class="va">fit</span><span class="op">$</span><span class="va">order</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">13</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">16</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">15</span>,<span class="fl">9</span>,<span class="fl">17</span>,<span class="fl">19</span>,<span class="fl">14</span>,<span class="fl">18</span>,<span class="fl">21</span>,<span class="fl">22</span>,<span class="fl">7</span>,<span class="fl">6</span>,<span class="fl">8</span>,<span class="fl">25</span>,<span class="fl">27</span>,<span class="fl">26</span>,<span class="fl">28</span>,<span class="fl">23</span>,<span class="fl">24</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/doclus-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="drilling-down-on-the-clustering">Drilling down on the clustering<a class="anchor" aria-label="anchor" href="#drilling-down-on-the-clustering"></a>
</h3>
<div class="section level4">
<h4 id="comparing-euclidean-and-correlation-distances">Comparing Euclidean and Correlation distances<a class="anchor" aria-label="anchor" href="#comparing-euclidean-and-correlation-distances"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bioDist/man/cor.dist.html" class="external-link">cor.dist</a></span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">)</span> <span class="co"># from bioDist</span>
<span class="va">ed</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ed</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"All pairwise Euclidean distances"</span>, ylab<span class="op">=</span><span class="st">"All pairwise correlation distances"</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/dodists-1.png" width="700"></p>
<p>For a given correlation distance value, there can be wide variation in euclidean distance, and vice versa.</p>
<p>Open question: What distance metric is most relevant for biological interpretation of CNV?</p>
</div>
<div class="section level4">
<h4 id="a-pair-with-discrepant-correlation-and-euclidean-distance-values-over-entire-genome">A pair with discrepant correlation and euclidean distance values (over entire genome)<a class="anchor" aria-label="anchor" href="#a-pair-with-discrepant-correlation-and-euclidean-distance-values-over-entire-genome"></a>
</h4>
<p>We’ll have a look at the first 100Mb on chr1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">[</span><span class="st">"Ly1"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>,pch<span class="op">=</span><span class="fl">19</span>, main<span class="op">=</span><span class="st">"chr1, first 100Mb"</span>, ylab<span class="op">=</span><span class="st">"FACETS CNV log R"</span>, xlab<span class="op">=</span><span class="st">"chr1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">[</span><span class="st">"Ln1"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"red"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">60</span>, <span class="op">-</span><span class="fl">.5</span>, pch<span class="op">=</span><span class="fl">19</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ly1"</span>, <span class="st">"Ln1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/lk1mb-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#cor(cnv_log_R["Ly1", 1:100], cnv_log_R["Ln1", 1:100])</span>
<span class="va">edist</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">edist</span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">[</span><span class="st">"Ly1"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>, <span class="va">cnv_log_R</span><span class="op">[</span><span class="st">"Ln1"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1.685992</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">cnv_log_R</span><span class="op">[</span><span class="st">"Ly1"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span>, <span class="va">cnv_log_R</span><span class="op">[</span><span class="st">"Ln1"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>, xlab<span class="op">=</span><span class="st">"Ly1"</span>, ylab<span class="op">=</span><span class="st">"Ln1"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/lk1mb-2.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="redo-clustering-with-alternative-distance-and-agglomeration-method">Redo clustering with alternative distance and agglomeration method<a class="anchor" aria-label="anchor" href="#redo-clustering-with-alternative-distance-and-agglomeration-method"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">cd</span>, method<span class="op">=</span><span class="st">"ward.D2"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">.3</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/redo-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="silhouette-measure">Silhouette measure<a class="anchor" aria-label="anchor" href="#silhouette-measure"></a>
</h4>
<p>From ?silhouette with the cluster library:</p>
<pre><code>For each observation i, the _silhouette width_ s(i) is defined as follows:

     Put a(i) = average dissimilarity between i and all other points of
     the cluster to which i belongs (if i is the _only_ observation in
     its cluster, s(i) := 0 without further calculations).  For all
     _other_ clusters C, put d(i,C) = average dissimilarity of i to all
     observations of C.  The smallest of these d(i,C) is b(i) := \min_C
     d(i,C), and can be seen as the dissimilarity between i and its
     "neighbor" cluster, i.e., the nearest one to which it does _not_
     belong.  Finally,

                   s(i) := ( b(i) - a(i) ) / max( a(i), b(i) ).         
     
     'silhouette.default()' is now based on C code donated by Romain
     Francois (the R version being still available as
     'cluster:::silhouette.default.R').

     Observations with a large s(i) (almost 1) are very well clustered,
     a small s(i) (around 0) means that the observation lies between
     two clusters, and observations with a negative s(i) are probably
     placed in the wrong cluster.</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ct1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">fit2</span>, h<span class="op">=</span><span class="fl">.3</span><span class="op">)</span>
<span class="va">c2</span> <span class="op">=</span> <span class="va">cnv_log_R</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">c2</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">c2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ct1</span><span class="op">)</span><span class="op">)</span>
<span class="va">sil</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/cluster/man/silhouette.html" class="external-link">silhouette</a></span><span class="op">(</span><span class="va">ct1</span>, <span class="va">cd</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sil</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/init-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="clustering-single-cell-rna-seq">Clustering single cell RNA-seq<a class="anchor" aria-label="anchor" href="#clustering-single-cell-rna-seq"></a>
</h2>
<p>This code is taken verbatim from the bluster “diagnostics” vignette.</p>
<div class="section level3">
<h3 id="acquire-grun-et-als-single-cell-rna-seq-dataset">Acquire Grun et al’s single cell RNA-seq dataset<a class="anchor" aria-label="anchor" href="#acquire-grun-et-als-single-cell-rna-seq-dataset"></a>
</h3>
<p>[Grun 2016] (<a href="https://www.sciencedirect.com/science/article/pii/S1934590916300947" class="external-link uri">https://www.sciencedirect.com/science/article/pii/S1934590916300947</a>) define an algorithm, StemID, that infers candidate multipotent cell populations in the human pancreas.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scRNAseq</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scRNAseq/man/GrunPancreasData.html" class="external-link">GrunPancreasData</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## snapshotDate(): 2022-04-26</span></code></pre>
<pre><code><span class="co">## see ?scRNAseq and browseVignettes('scRNAseq') for documentation</span></code></pre>
<pre><code><span class="co">## loading from cache</span></code></pre>
<pre><code><span class="co">## snapshotDate(): 2022-04-26</span></code></pre>
<pre><code><span class="co">## see ?scRNAseq and browseVignettes('scRNAseq') for documentation</span></code></pre>
<pre><code><span class="co">## loading from cache</span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Quality control to remove bad cells.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scuttle</span><span class="op">)</span>
<span class="va">qcstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/perCellQCMetrics.html" class="external-link">perCellQCMetrics</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="va">qcfilter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/quickPerCellQC.html" class="external-link">quickPerCellQC</a></span><span class="op">(</span><span class="va">qcstats</span>, sub.fields<span class="op">=</span><span class="st">"altexps_ERCC_percent"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in .get_med_and_mad(metric, batch = batch, subset = subset,</span>
<span class="co">## share.medians = share.medians, : missing values ignored during outlier detection</span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sce</span> <span class="op">&lt;-</span> <span class="va">sce</span><span class="op">[</span>,<span class="op">!</span><span class="va">qcfilter</span><span class="op">$</span><span class="va">discard</span><span class="op">]</span>

<span class="co"># Normalization by library size.</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scuttle/man/logNormCounts.html" class="external-link">logNormCounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>

<span class="co"># Feature selection.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scran</span><span class="op">)</span>
<span class="va">dec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/modelGeneVar.html" class="external-link">modelGeneVar</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="va">hvgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scran/man/getTopHVGs.html" class="external-link">getTopHVGs</a></span><span class="op">(</span><span class="va">dec</span>, n<span class="op">=</span><span class="fl">1000</span><span class="op">)</span>

<span class="co"># Dimensionality reduction.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://bioconductor.org/packages/scater/" class="external-link">scater</a></span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runPCA.html" class="external-link">runPCA</a></span><span class="op">(</span><span class="va">sce</span>, ncomponents<span class="op">=</span><span class="fl">20</span>, subset_row<span class="op">=</span><span class="va">hvgs</span><span class="op">)</span>
<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scater/man/runTSNE.html" class="external-link">runTSNE</a></span><span class="op">(</span><span class="va">sce</span>, subset_row<span class="op">=</span><span class="va">hvgs</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clustering-using-a-nearest-neighbor-graph-visualization-via-tsne-and-pca">Clustering using a nearest-neighbor graph; visualization via TSNE and PCA<a class="anchor" aria-label="anchor" href="#clustering-using-a-nearest-neighbor-graph-visualization-via-tsne-and-pca"></a>
</h3>
<p>From bluster’s makeSNNGraph help page</p>
<pre><code>   The 'makeSNNGraph' function builds a shared nearest-neighbour
   graph using observations as nodes. For each observation, its 'k'
   nearest neighbours are identified using the 'findKNN' function,
   based on distances between their expression profiles (Euclidean by
   default). An edge is drawn between all pairs of observations that
   share at least one neighbour, weighted by the characteristics of
   the shared nearest neighbors - see "Weighting Schemes" below.

   The aim is to use the SNN graph to perform clustering of
   observations via community detection algorithms in the 'igraph'
   package. This is faster and more memory efficient than
   hierarchical clustering for large numbers of observations. In
   particular, it avoids the need to construct a distance matrix for
   all pairs of observations. Only the identities of nearest
   neighbours are required, which can be obtained quickly with
   methods in the 'BiocNeighbors' package.</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bluster</span><span class="op">)</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDim</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span>
<span class="va">clust.info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bluster/man/clusterRows.html" class="external-link">clusterRows</a></span><span class="op">(</span><span class="va">mat</span>, <span class="fu"><a href="https://rdrr.io/pkg/bluster/man/NNGraphParam-class.html" class="external-link">NNGraphParam</a></span><span class="op">(</span><span class="op">)</span>, full<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">clusters</span> <span class="op">&lt;-</span> <span class="va">clust.info</span><span class="op">$</span><span class="va">clusters</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## clusters</span>
<span class="co">##   1   2   3   4   5   6   7   8   9  10  11  12 </span>
<span class="co">## 285 171 161  59 174  49  70 137  69  65  28  23</span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDims</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">TSNE</span>, col<span class="op">=</span><span class="va">clusters</span>, pch<span class="op">=</span><span class="fl">19</span>, main<span class="op">=</span><span class="st">"TSNE"</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/graphclust-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDims</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">PCA</span>, col<span class="op">=</span><span class="va">clusters</span>, pch<span class="op">=</span><span class="fl">19</span>, main<span class="op">=</span><span class="st">"PCA"</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/graphclust-2.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDims</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">$</span><span class="va">PCA</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, col<span class="op">=</span><span class="va">clusters</span>, pch<span class="op">=</span><span class="fl">19</span>, main<span class="op">=</span><span class="st">"PCA"</span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/graphclust-3.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="assessment-via-pairwisemodularity">Assessment via pairwiseModularity<a class="anchor" aria-label="anchor" href="#assessment-via-pairwisemodularity"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">clust.info</span><span class="op">$</span><span class="va">objects</span><span class="op">$</span><span class="va">graph</span>
<span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bluster/man/pairwiseModularity.html" class="external-link">pairwiseModularity</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">clusters</span>, as.ratio<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="va">cluster.gr</span> <span class="op">&lt;-</span> <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_adjacency_matrix.html" class="external-link">graph_from_adjacency_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, 
    mode<span class="op">=</span><span class="st">"upper"</span>, weighted<span class="op">=</span><span class="cn">TRUE</span>, diag<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Increasing the weight to increase the visibility of the lines.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1100101</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cluster.gr</span>, edge.width<span class="op">=</span><span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">cluster.gr</span><span class="op">)</span><span class="op">$</span><span class="va">weight</span><span class="op">*</span><span class="fl">5</span>,
    layout<span class="op">=</span><span class="fu">igraph</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/igraph/man/layout_with_lgl.html" class="external-link">layout_with_lgl</a></span><span class="op">)</span></code></pre></div>
<p><img src="distplus_files/figure-html/dopairw-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Vincent Carey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
